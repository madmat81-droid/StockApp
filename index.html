<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>StockApp</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet" />
  <link rel="icon" href="data:," />
  <style>
    body{background:#0a0c10;color:#e8eaee}
    .navbar{background:#0f121b}
    .card{background:#131622;border-radius:12px;border:1px solid #1f2330}
    .form-control,.form-select{background:#0e1220;color:#e8eaee;border-color:#1e2432}
    .btn-primary{background:#3b82f6;border-color:#3b82f6}
    .muted{color:#9aa3af}
  </style>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark">
  <div class="container">
    <a class="navbar-brand fw-semibold" href="#/stock"><i class="bi bi-box-seam me-2"></i>StockApp</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navCollapse">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div id="navCollapse" class="collapse navbar-collapse">
      <ul class="navbar-nav me-auto ms-3 gap-2">
        <li class="nav-item"><a class="nav-link" href="#/stock">Stock</a></li>
        <li class="nav-item"><a class="nav-link" href="#/stats">Statistiche</a></li>
      </ul>
      <div class="ms-auto d-flex gap-2 align-items-center">
        <span id="userInfo" class="badge rounded-pill bg-dark d-none"></span>
        <button id="btnLogout" class="btn btn-sm btn-outline-light d-none" type="button">Logout</button>
      </div>
    </div>
  </div>
</nav>

<main class="container py-4">
  <!-- LOGIN UNICO -->
  <section id="page-auth" class="card">
    <div class="card-body">
      <h3 class="h5 mb-3">Accesso al portale</h3>
      <div class="row g-2 align-items-end">
        <div class="col-md-4">
          <label class="form-label">Email</label>
          <input id="email" class="form-control" autocomplete="username" placeholder="you@example.com" />
        </div>
        <div class="col-md-4">
          <label class="form-label">Password</label>
          <input id="password" type="password" class="form-control" autocomplete="current-password" placeholder="••••••" />
        </div>
        <div class="col-md-4">
          <button id="btnLogin" class="btn btn-primary w-100" type="button">Entra</button>
          <div id="authError" class="alert alert-danger mt-3 d-none" role="alert"></div>
        </div>
      </div>
    </div>
  </section>
</main>

<script type="module">
import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js';
import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.12.3/firebase-auth.js';

const firebaseConfig = {
  apiKey: "AIzaSyABezXPgHhyvPknItXGyuvA-vKozNw6_qw",
  authDomain: "stockappdb-2420d.firebaseapp.com",
  projectId: "stockappdb-2420d"
};
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);

const emailInput=document.getElementById('email');
const passwordInput=document.getElementById('password');
const loginBtn=document.getElementById('btnLogin');
const errorBox=document.getElementById('authError');
const userInfo=document.getElementById('userInfo');
const btnLogout=document.getElementById('btnLogout');

async function doLogin(email,password){
  errorBox.classList.add('d-none');
  try{
    await signInWithEmailAndPassword(auth,email,password);
  }catch(err){
    console.error('LOGIN ERROR:',err);
    errorBox.textContent='Credenziali errate o problema di rete';
    errorBox.classList.remove('d-none');
  }
}

loginBtn.addEventListener('click',()=>doLogin(emailInput.value.trim(),passwordInput.value));

onAuthStateChanged(auth,(user)=>{
  if(user){
    userInfo.textContent=user.email;
    userInfo.classList.remove('d-none');
    btnLogout.classList.remove('d-none');
    document.getElementById('page-auth').classList.add('d-none');
  } else {
    userInfo.classList.add('d-none');
    btnLogout.classList.add('d-none');
    document.getElementById('page-auth').classList.remove('d-none');
  }
});

btnLogout.addEventListener('click',()=>signOut(auth));
</script>
</body>
</html>
